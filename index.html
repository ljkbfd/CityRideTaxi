<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>CityRide Taxi â€” Instant Quote & Booking</title>
  <meta name="description" content="Instant taxi quotes with distance-based pricing and easy booking." />
  <style>
    :root{
      --bg:#0b1020;--card:#11162a;--text:#e7ecff;--muted:#a8b0d9;
      --accent:#7aa2ff;--accent2:#67e8f9;--ring:rgba(122,162,255,.35);
      --whatsapp:#25D366;
      --radius:16px; --shadow:0 12px 32px -14px var(--ring); --maxw:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
      background:linear-gradient(180deg,#0b1020,#0b1020 40%,#101735 100%);
      color:var(--text);line-height:1.6;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;
    }
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:var(--maxw);margin-inline:auto;padding:20px}
    .nav{display:flex;justify-content:center;align-items:center;padding-block:6px}
    .brand{font-weight:900;letter-spacing:.3px;text-align:center;
           font-size:clamp(1.9rem,7.4vw,2.8rem)}
    .btn{
      display:inline-flex;justify-content:center;align-items:center;
      padding:14px 18px;border-radius:14px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      color:#051023;font-weight:800;border:none;box-shadow:var(--shadow);cursor:pointer
    }
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn-secondary{background:#172149;color:var(--text);border:1px solid rgba(255,255,255,.12)}
    .btn-wa{
      background:var(--whatsapp);color:#05160d;font-weight:900;border:none;
      border-radius:14px;padding:14px 18px;display:inline-flex;align-items:center;gap:10px;
      justify-content:center;box-shadow:0 8px 24px -10px rgba(37,211,102,.6)
    }
    /* NEW: center the Calculate button with fixed width */
    .center-row{display:flex;justify-content:center;margin-top:10px}
    .btn-fixed{width:280px;max-width:100%}

    .hero{display:grid;grid-template-columns:1fr;gap:18px;align-items:start;padding-block:12px}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--ring);
          border-radius:999px;padding:6px 10px;color:var(--muted);font-size:.95rem;
          background:rgba(255,255,255,.03)}
    h1{font-size:clamp(1.8rem,6vw,2.6rem);line-height:1.15;margin:.5em 0;text-align:center}
    .card{
      background:radial-gradient(1200px 500px at -10% -10%,rgba(122,162,255,.12),transparent 40%),
                 radial-gradient(800px 300px at 120% 10%,rgba(103,232,249,.10),transparent 35%),
                 var(--card);
      border:1px solid rgba(122,162,255,.15);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
    }
    .section{padding-block:18px}
    .grid{display:grid;gap:16px}
    .two{grid-template-columns:1fr}
    @media(min-width:960px){
      .two{grid-template-columns:1.15fr .85fr}
    }
    label{display:block;margin:.35rem 0 .25rem;color:var(--muted)}
    input,textarea,select{
      width:100%;padding:14px 14px;border-radius:14px;border:1px solid rgba(255,255,255,.14);
      background:#0c142e;color:var(--text);font-size:16px;
    }
    input::placeholder,textarea::placeholder{color:#9aa3cf}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > *{flex:1 1 160px}
    .tiny{font-size:.95rem;color:var(--muted)}
    .quote{font-size:clamp(1.2rem,5vw,1.6rem);font-weight:800}
    .notice{border-left:3px solid var(--accent);padding:12px 14px;background:rgba(122,162,255,.08);border-radius:10px;margin-top:10px}
    .result{padding:14px;border-radius:14px;border:1px solid rgba(122,162,255,.25);background:rgba(255,255,255,.03)}
    .hidden{display:none}
    #map{height:46vh;border-radius:14px}
    @media(min-width:960px){ #map{height:560px} }
    .ac-wrap{position:relative}
    .ac-list{position:absolute;left:0;right:0;top:100%;z-index:30;background:#0c142e;border:1px solid rgba(255,255,255,.14);border-top:none;border-radius:0 0 12px 12px;max-height:240px;overflow:auto}
    .ac-item{padding:12px 12px;cursor:pointer;border-top:1px solid rgba(255,255,255,.08)}
    .ac-item:hover{background:#101a3a}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .center{text-align:center}

    /* FIXED: stacked, aligned contact method */
    .contact-method{
      display:grid;gap:10px;margin-top:6px;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    }
    .contact-option{
      position:relative;display:flex;align-items:center;justify-content:center;gap:8px;
      padding:14px;border:1px solid rgba(255,255,255,.14);
      border-radius:12px;background:#0c142e;cursor:pointer;user-select:none;
      transition:border-color .2s ease, box-shadow .2s ease, background .2s ease;
    }
    .contact-option input[type="radio"]{
       position:absolute;inset:0;margin:0;opacity:0;pointer-events:none;
    }
    .contact-option::before{
      content:"";width:14px;height:14px;border-radius:50%;
      border:2px solid rgba(255,255,255,.35);transition:background .2s ease,border-color .2s ease;}

    .contact-option span{
            margin:0;text-align:center;color:var(--text);font-weight:700;flex:1;
    }
    .contact-option.active{
      border-color: var(--accent);
      background:rgba(122,162,255,.12);
      box-shadow:0 0 0 3px rgba(122,162,255,.18) inset;
    }
    .contact-option:focus-within{
      outline:2px solid rgba(122,162,255,.4);
      outline-offset:2px;
    }
    .contact-option.active::before{
      border-color:var(--accent);background:var(--accent);
    }
    .contact-option:focus-within{
      box-shadow:0 0 0 3px rgba(122,162,255,.18) inset,0 0 0 3px rgba(122,162,255,.25);
    }

    .contact-option.active{ border-color: var(--accent); box-shadow: 0 0 0 3px rgba(122,162,255,.18) inset; }

    .bottom-cta{display:flex;justify-content:center;margin:18px 0 8px}
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>
<body>
  <a href="#main" class="sr-only">Skip to content</a>
  <div class="container" id="main">
    <nav class="nav">
      <div class="brand">CityRide Taxi</div>
    </nav>

    <header class="hero">
      <div class="center">
        <span class="pill">ðŸš• Instant quote â€¢ ðŸ’³ PayPal checkout</span>
        <h1>Book your ride</h1>
      </div>
    </header>

    <section id="book" class="section">
      <div class="grid two">
        <div class="card" style="padding:14px">
          <h2 class="center" style="margin:6px 0 8px">Get an instant price</h2>

          <form id="quoteForm">
            <label for="from">Pickup location</label>
            <div class="ac-wrap">
              <input id="from" placeholder="Enter pickup address" autocomplete="off" required inputmode="text">
              <div id="from-ac" class="ac-list hidden"></div>
            </div>

            <label for="to">Drop-off location</label>
            <div class="ac-wrap">
              <input id="to" placeholder="Enter drop-off address" autocomplete="off" required inputmode="text">
              <div id="to-ac" class="ac-list hidden"></div>
            </div>

            <div class="row">
              <div>
                <label for="date">Date</label>
                <input type="date" id="date" required>
              </div>
              <div>
                <label for="time">Time</label>
                <input type="time" id="time" required>
              </div>
            </div>

            <div class="row">
              <div>
                <label for="pax">Passengers</label>
                <input type="number" id="pax" min="1" max="6" value="1" inputmode="numeric">
              </div>
              <div>
                <label for="bags">Luggage (bags)</label>
                <input type="number" id="bags" min="0" max="6" value="0" inputmode="numeric">
              </div>
            </div>

            <!-- Promo field removed; button centered & fixed width -->
            <div class="center-row">
              <button id="calcBtn" type="button" class="btn btn-fixed">Calculate price</button>
            </div>
          </form>

          <div id="quoteBox" class="result hidden" style="margin-top:10px">
            <div class="tiny">Distance</div>
            <div id="km">â€“</div>
            <div class="tiny" style="margin-top:6px">Estimated price</div>
            <div id="price" class="quote">â€“</div>
            <div class="tiny" id="breakdown"></div>
            <div class="notice tiny">This is an instant estimate. Final price confirmed on acceptance.</div>

            <!-- CONTACT PREFERENCES -->
            <div style="margin-top:12px">
              <label>How should we contact you?</label>

              <div class="contact-method" id="contactMethod">
                <label class="contact-option active">
                  <input type="radio" name="contact_method" value="email" checked>
                  <span>Email</span>
                </label>
                <label class="contact-option">
                  <input type="radio" name="contact_method" value="whatsapp">
                  <span>WhatsApp</span>
                </label>
              </div>

              <div id="emailWrap" style="margin-top:8px">
                <label for="contactEmail">Your Email</label>
                <input type="email" id="contactEmail" placeholder="name@example.com" inputmode="email" autocomplete="email">
              </div>

              <div id="waWrap" class="hidden" style="margin-top:8px">
                <label for="contactWhatsApp">Your WhatsApp Number</label>
                <input type="tel" id="contactWhatsApp" placeholder="+44 7xxx xxx xxx" pattern="^\+?[0-9()\-\s]{7,}$" inputmode="tel" autocomplete="tel">
                <small class="tiny">Use international format if possible (e.g., +44 for UK).</small>
              </div>

              <label for="customerName" style="margin-top:10px">Your Name</label>
              <input id="customerName" placeholder="Your full name" autocomplete="name">
            </div>

            <button id="requestBtn" class="btn btn-full" style="margin-top:10px">Request booking</button>
            <p id="formMsg" class="tiny hidden" style="color:#67e8f9;margin-top:8px">Request sent! Weâ€™ll review and reply shortly.</p>
            <p id="formErr" class="tiny hidden" style="color:#ff9aa2;margin-top:8px"></p>
          </div>
        </div>

        <div class="card" style="padding:14px">
          <h2 class="center" style="margin:6px 0 8px">Route preview</h2>
          <p class="tiny center">Map updates after you calculate a quote.</p>
          <div id="map"></div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="card" style="padding:14px">
        <h2 style="margin:6px 0 8px">What happens after you request:</h2>
        <ol class="tiny" style="padding-left:18px">
          <li>We review your request (route, time, luggage).</li>
          <li>We accept with the final fixed price or explain why we cannot take it.</li>
          <li>You receive a PayPal link to pay by card or PayPal.</li>
          <li>Receipt sent automatically; driver details shared before pickup.</li>
        </ol>
      </div>
    </section>

    <div class="bottom-cta">
      <a class="btn-wa" href="https://wa.me/447000000000" target="_blank" rel="noopener" aria-label="Chat on WhatsApp">
        <svg aria-hidden="true" width="18" height="18" viewBox="0 0 32 32" fill="currentColor">
          <path d="M19.11 17.01c-.27-.13-1.6-.79-1.85-.88-.25-.09-.43-.13-.62.13-.18.27-.71.88-.87 1.06-.16.18-.32.2-.59.07-.27-.13-1.15-.42-2.19-1.35-.81-.72-1.36-1.61-1.52-1.88-.16-.27-.02-.41.11-.54.11-.11.27-.29.4-.44.13-.16.18-.27.27-.45.09-.18.04-.34-.02-.48-.07-.13-.62-1.49-.85-2.05-.22-.53-.45-.46-.62-.46-.16 0-.34-.02-.52-.02-.18 0-.48.07-.73.34-.25.27-.96.94-.96 2.3 0 1.36.99 2.67 1.13 2.85.13.18 1.94 2.96 4.7 4.15.66.28 1.18.45 1.58.58.66.21 1.26.18 1.74.11.53-.08 1.6-.65 1.83-1.28.23-.63.23-1.17.16-1.28-.07-.11-.25-.18-.52-.31zM26.9 5.1C24.2 2.39 20.74.89 17.06.89 8.89.89 2.2 7.58 2.2 15.75c0 2.54.66 5.02 1.92 7.22L2 30l7.2-2.06c2.14 1.17 4.55 1.79 6.99 1.79h.01c8.17 0 14.86-6.69 14.86-14.86 0-3.68-1.5-7.14-4.21-9.85zm-9.84 22.94h-.01c-2.24 0-4.45-.61-6.38-1.77l-.46-.27-4.27 1.22 1.22-4.16-.3-.49c-1.2-1.96-1.83-4.23-1.83-6.56 0-6.85 5.57-12.42 12.42-12.42 3.32 0 6.44 1.29 8.79 3.64 2.35 2.35 3.64 5.47 3.64 8.79 0 6.85-5.57 12.42-12.42 12.42z"/>
        </svg>
        Chat on WhatsApp
      </a>
    </div>

  </div>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script>
    const CONFIG = {
      currency: 'GBP',
      baseFare: 5.00, perKmDay: 1.10, perKmNight: 1.35, airportMeet: 5.00, minFare: 8.00
      // promoCodes removed
    };
    const GEOAPIFY_KEY = '8476737f3cd74e68a78697c878ed0879';

    let map = L.map('map', { tapTolerance: 10 }).setView([55.9533, -3.1883], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);
    let routeLayer = null;

    function attachAutocomplete(inputEl, listEl){
      let t; const clearList = ()=>{ listEl.innerHTML=''; listEl.classList.add('hidden'); };
      inputEl.addEventListener('input', () => {
        clearTimeout(t); const q = inputEl.value.trim();
        if(q.length < 3){ clearList(); return; }
        t = setTimeout(async () => {
          try{
            const url = `https://api.geoapify.com/v1/geocode/autocomplete?text=${encodeURIComponent(q)}&limit=6&apiKey=${GEOAPIFY_KEY}`;
            const res = await fetch(url); if(!res.ok) throw new Error('autocomplete failed');
            const data = await res.json();
            listEl.innerHTML = '';
            (data.features||[]).forEach(f => {
              const d = f.properties;
              const item = document.createElement('div');
              item.className = 'ac-item';
              item.textContent = d.formatted;
              item.addEventListener('mousedown', () => {
                inputEl.value = d.formatted;
                inputEl.dataset.lon = d.lon; inputEl.dataset.lat = d.lat; inputEl.dataset.label = d.formatted;
                clearList();
              });
              listEl.appendChild(item);
            });
            listEl.classList.toggle('hidden', listEl.children.length===0);
          } catch(e){ clearList(); }
        }, 220);
      });
      inputEl.addEventListener('blur', () => setTimeout(()=>listEl.classList.add('hidden'), 120));
      inputEl.addEventListener('focus', () => { if(listEl.children.length>0) listEl.classList.remove('hidden'); });
    }
    attachAutocomplete(document.getElementById('from'), document.getElementById('from-ac'));
    attachAutocomplete(document.getElementById('to'), document.getElementById('to-ac'));

    async function geocodeFromInput(input){
      const lat = input.dataset.lat, lon = input.dataset.lon, label = input.dataset.label;
      if(lat && lon){ return { lat: parseFloat(lat), lon: parseFloat(lon), label }; }
      const q = input.value.trim();
      const url = `https://api.geoapify.com/v1/geocode/search?text=${encodeURIComponent(q)}&limit=1&apiKey=${GEOAPIFY_KEY}`;
      const res = await fetch(url); if(!res.ok) throw new Error('Geocoding failed');
      const data = await res.json(); const f = data.features && data.features[0];
      if(!f) throw new Error('Location not found');
      return { lon: f.properties.lon, lat: f.properties.lat, label: f.properties.formatted };
    }

    async function routeDistance(from, to){
      const url = `https://api.geoapify.com/v1/routing?waypoints=${from[0]},${from[1]}|${to[0]},${to[1]}&mode=drive&apiKey=${GEOAPIFY_KEY}`;
      const res = await fetch(url); if(!res.ok) throw new Error('Routing failed');
      const data = await res.json();
      const feat = data.features && data.features[0];
      if(!feat) throw new Error('No route found');
      const km = (feat.properties.distance || 0) / 1000;
      const seconds = (feat.properties.time || 0);
      return { km, seconds, geometry: feat.geometry };
    }

    const calcBtn = document.getElementById('calcBtn');
    const quoteBox = document.getElementById('quoteBox');
    function isNight(t){ const [h]=t.split(':').map(Number); return (h>=22||h<6); }
    function calcPrice(km, t){
      const rate = isNight(t) ? CONFIG.perKmNight : CONFIG.perKmDay;
      let price = CONFIG.baseFare + km*rate;
      if (/airport/i.test(document.getElementById('to').value)) price += CONFIG.airportMeet;
      return Math.max(price, CONFIG.minFare);
    }
    function drawRoute(geo){
      if(routeLayer) routeLayer.remove();
      routeLayer = L.geoJSON(geo, { style:{weight:5} }).addTo(map);
      map.fitBounds(routeLayer.getBounds(), { padding:[20,20] });
    }

    function updateContactActive(){
      document.querySelectorAll('.contact-option').forEach(lbl => {
        const checked = lbl.querySelector('input[type="radio"]').checked;
        lbl.classList.toggle('active', checked);
      });
    }

    calcBtn.addEventListener('click', async () => {
      if(!GEOAPIFY_KEY || GEOAPIFY_KEY === 'PASTE_YOUR_GEOAPIFY_KEY_HERE'){ alert('Please add your Geoapify API key in the code.'); return; }
      const fromEl = document.getElementById('from'), toEl = document.getElementById('to');
      const date = document.getElementById('date').value, time = document.getElementById('time').value;
      if(!date || !time){ alert('Please select date and time.'); return; }
      calcBtn.disabled = true; const old = calcBtn.textContent; calcBtn.textContent = 'Calculatingâ€¦';
      try{
        const A = await geocodeFromInput(fromEl);
        const B = await geocodeFromInput(toEl);
        const { km, seconds, geometry } = await routeDistance([A.lat,A.lon],[B.lat,B.lon]);
        document.getElementById('km').textContent = km.toFixed(2) + ' km';
        const price = calcPrice(km, time);
        document.getElementById('price').textContent = 'Â£' + price.toFixed(2);
        document.getElementById('breakdown').textContent =
          `Base Â£${CONFIG.baseFare.toFixed(2)} + Â£${(isNight(time)?CONFIG.perKmNight:CONFIG.perKmDay).toFixed(2)}/km Ã— ${km.toFixed(2)} km` +
          `${CONFIG.airportMeet? ' + airport Â£'+CONFIG.airportMeet.toFixed(2): ''} (min Â£${CONFIG.minFare.toFixed(2)})`;
        quoteBox.classList.remove('hidden');
        drawRoute(geometry);
        quoteBox.dataset.price = price.toFixed(2);
        quoteBox.dataset.km = km.toFixed(2);
        quoteBox.dataset.from = A.label || fromEl.value.trim();
        quoteBox.dataset.to = B.label || toEl.value.trim();
        quoteBox.dataset.date = date;
        quoteBox.dataset.time = time;
        quoteBox.dataset.pax = document.getElementById('pax').value;
        quoteBox.dataset.bags = document.getElementById('bags').value;
      } catch(e){ alert('Could not calculate route: ' + e.message); }
      finally{ calcBtn.disabled = false; calcBtn.textContent = old; }
    });

    const emailWrap = document.getElementById("emailWrap");
    const waWrap = document.getElementById("waWrap");
    const contactEmail = document.getElementById("contactEmail");
    const contactWhatsApp = document.getElementById("contactWhatsApp");
    const customerName = document.getElementById("customerName");
    const formMsg = document.getElementById("formMsg");
    const formErr = document.getElementById("formErr");
    function setHidden(el, yes){ el.classList.toggle('hidden', !!yes); }
    function normalizePhone(raw){ return (raw||'').replace(/[()\-\s]/g,''); }

    document.querySelectorAll('input[name="contact_method"]').forEach(r => {
      r.addEventListener('change', () => {
        const method = document.querySelector('input[name="contact_method"]:checked').value;
        if(method === 'email'){ setHidden(emailWrap, false); setHidden(waWrap, true); contactWhatsApp.value = ""; }
        else { setHidden(emailWrap, true); setHidden(waWrap, false); contactEmail.value = ""; }
        setHidden(formMsg, true); setHidden(formErr, true);
        updateContactActive();
      });
    });
    updateContactActive();

    const requestBtn = document.getElementById('requestBtn');
    requestBtn.addEventListener('click', async () => {
      if(!quoteBox.dataset.from){ alert('Please calculate a quote first.'); return; }
      const method = document.querySelector('input[name="contact_method"]:checked').value;
      const email = (contactEmail.value||'').trim();
      const wa = normalizePhone(contactWhatsApp.value||'');
      const name = (customerName.value||'').trim();
      setHidden(formMsg, true); setHidden(formErr, true);
      if(method === 'email' && !email){ formErr.textContent = "Please enter your email address."; setHidden(formErr, false); return; }
      if(method === 'whatsapp' && !wa){ formErr.textContent = "Please enter your WhatsApp number."; setHidden(formErr, false); return; }

      const FORMSPREE_ENDPOINT = 'https://formspree.io/f/mrbooyor';
      const payload = {
        _subject: "New Taxi Request via Website",
        contact_method: method,
        email: method==='email' ? email : '',
        whatsapp: method==='whatsapp' ? wa : '',
        name,
        from: quoteBox.dataset.from,
        to: quoteBox.dataset.to,
        date: quoteBox.dataset.date,
        time: quoteBox.dataset.time,
        pax: quoteBox.dataset.pax,
        bags: quoteBox.dataset.bags,
        distance_km: quoteBox.dataset.km,
        quoted_price: quoteBox.dataset.price,
        source: 'website-quote'
      };

      requestBtn.disabled = true; const oldText = requestBtn.textContent;
      requestBtn.textContent = 'Sendingâ€¦';
      try{
        const res = await fetch(FORMSPREE_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Accept':'application/json' },
          body: JSON.stringify(payload)
        });
        if(res.ok){
          formMsg.textContent = (method === 'email')
            ? "Request sent! Weâ€™ll review and reply to your email."
            : "Request sent! Weâ€™ll review and reply to your WhatsApp number.";
          setHidden(formMsg, false);
        } else {
          formErr.textContent = "Could not send request. Please WhatsApp or call us.";
          setHidden(formErr, false);
        }
      } catch(e){
        formErr.textContent = "Network error. Please WhatsApp or call us.";
        setHidden(formErr, false);
      } finally {
        requestBtn.disabled = false; requestBtn.textContent = oldText;
      }
    });
  </script>
</body>
</html>

